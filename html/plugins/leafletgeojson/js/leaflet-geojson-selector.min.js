/* 
 * Leaflet GeoJSON Selector v0.5.4 - 2018-09-28 
 * 
 * Copyright 2018 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demo: 
 * http://labs.easyblog.it/maps/leaflet-geojson-selector/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-geojson-selector.git 
 * 
 */
!function(a){if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!=typeof module)module.exports=a(require("leaflet"));else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";a(window.L)}}(function(a){return a.Control.GeoJSONSelector=a.Control.extend({includes:"1"===a.version[0]?a.Evented.prototype:a.Mixin.Events,options:{position:"bottomleft",listLabel:"properties.name",listSortBy:null,listItemBuild:null,activeListFromLayer:!0,activeLayerFromList:!0,zoomToLayer:!1,listOnlyVisibleLayers:!1,multiple:!1,style:{color:"#00f",fillColor:"#08f",fillOpacity:.4,opacity:1,weight:1},activeClass:"active",activeStyle:{color:"#00f",fillColor:"#fc0",fillOpacity:.6,opacity:1,weight:1},selectClass:"selected",selectStyle:{color:"#00f",fillColor:"#f80",fillOpacity:.8,opacity:1,weight:1}},initialize:function(b,c){a.Util.setOptions(this,c||{});this.options.listSortBy=this.options.listSortBy||this.options.listLabel,this.options.listItemBuild&&(this._itemBuild=this.options.listItemBuild),this._layer=b},onAdd:function(b){var c=this;this._container=a.DomUtil.create("div","geojson-list"),this._baseName="geojson-list",this._map=b,this._id=this._baseName+a.stamp(this._container),this._list=a.DomUtil.create("ul","geojson-list-group",this._container),this._layer&&this._map.addLayer(this._layer),this._items=[],a.DomEvent.disableClickPropagation(this._container).disableScrollPropagation(this._container),this.options.listOnlyVisibleLayers&&b.on("moveend",this._updateVisible,this);var d=b.getSize();return c._container.style.height=d.y+"px",c._container.style.maxWidth=d.x/2+"px",c._update(),this._container},onRemove:function(a){a.off("moveend",this._updateVisible,this),this._layer.remove()},reload:function(a){return this._map&&(this._layer&&this._map.removeLayer(this._layer),this._map.addLayer(a),this._layer=a,this._update()),this},_getPath:function(a,b){var c=b.split("."),d=c.pop(),e=c.length,f=c[0],g=1;if(e>0)for(;(a=a[f])&&e>g;)f=c[g++];return a?a[d]:void 0},_itemBuild:function(a){return this._getPath(a.feature,this.options.listLabel)||"&nbsp;"},_selectItem:function(b,c){for(var d=0;d<this._items.length;d++)delete this._items[d].selected,a.DomUtil.removeClass(this._items[d],this.options.selectClass);c&&(b.selected=c,a.DomUtil.addClass(b,this.options.selectClass))},_selectLayer:function(a,b){for(var c=0;c<this._items.length;c++)this._items[c].layer.setStyle&&this._items[c].layer.setStyle(this.options.style);b&&a.setStyle&&a.setStyle(this.options.selectStyle)},_createItem:function(b){var c=this,d=a.DomUtil.create("li","geojson-list-item"),e=document.createElement("label"),f=this.options.multiple?"checkbox":"radio",g=this._createInputElement(f,this._id,!1),h=this._itemBuild.call(this,b);return e.innerHTML=h,e.insertBefore(g,e.firstChild),d.appendChild(e),d.layer=b,b.itemList=d,b.itemLabel=e,a.DomEvent.on(e,"click",a.DomEvent.stop,this).on(e,"click",function(a){c.options.zoomToLayer&&c._moveTo(b),g.checked=!g.checked,c._selectItem(d,g.checked),c._selectLayer(b,g.checked),c.fire("selector:change",{selected:g.checked,layers:[b]})},this),a.DomEvent.on(d,"mouseover",function(b){a.DomUtil.addClass(b.target,this.options.activeClass);for(var e=0;e<c._items.length;e++)c._items[e]||c._items[e].layer.setStyle(c.options.activeStyle);c.options.activeLayerFromList&&d.layer.fire("mouseover")},this).on(d,"mouseout",function(b){a.DomUtil.removeClass(b.target,c.options.activeClass);for(var e=0;e<c._items.length;e++)c._items[e]||c._items[e].layer.setStyle(c.options.style);c.options.activeLayerFromList&&d.layer.fire("mouseout")},this),this._items.push(d),d},_createInputElement:function(a,b,c){var d='<input type="'+a+'" name="'+b+'"';c&&(d+=' checked="checked"'),d+="/>";var e=document.createElement("div");return e.innerHTML=d,e.firstChild},_update:function(){var b=this,c=[];if(this._layer){this._list.innerHTML="",this._layer.eachLayer(function(d){c.push(d),d.setStyle&&d.setStyle(b.options.style),d.on("click",a.DomEvent.stop).on("click",function(a){a.target.itemLabel.click()}).on("mouseover",function(c){c.target.setStyle&&c.target.setStyle(b.options.activeStyle),b.options.activeListFromLayer&&a.DomUtil.addClass(c.target.itemList,b.options.activeClass)}).on("mouseout",function(c){c.target.setStyle&&c.target.setStyle(c.target.itemList.selected?b.options.selectStyle:b.options.style),b.options.activeListFromLayer&&a.DomUtil.removeClass(c.target.itemList,b.options.activeClass)})}),this.options.listSortBy&&c.sort(function(a,c){var d=b.options.listSortBy,e=b._getPath(a.feature,d),f=b._getPath(c.feature,d);return f>e?-1:e>f?1:0});for(var d=0;d<c.length;d++)b._list.appendChild(b._createItem(c[d]));this._map.addLayer(this._layer),this._layer.getBounds&&setTimeout(function(){b._moveTo(b._layer)},50)}},_updateVisible:function(){var a,b=this,c=b._map.getBounds();this._layer&&this._layer.eachLayer(function(b){b.getBounds?a=c.intersects(b.getBounds()):b.getLatLng&&(a=c.contains(b.getLatLng())),b.itemList&&(b.itemList.style.display=a?"block":"none")})},_moveTo:function(b){var c=this,d=this.options.position,e=a.point(this._container.clientWidth,this._container.clientHeight),f={paddingTopLeft:null,paddingBottomRight:null};if(-1!==d.indexOf("right")?f.paddingBottomRight=a.point(e.x,0):-1!==d.indexOf("left")&&(f.paddingTopLeft=a.point(e.x,0)),b.getBounds){var g=b.getBounds();g.isValid()&&c._map.fitBounds(g,f)}else b.getLatLng&&c._map.setView(b.getLatLng(),f)}}),a.control.geoJsonSelector=function(b,c){return new a.Control.GeoJSONSelector(b,c)},a.Control.GeoJSONSelector});